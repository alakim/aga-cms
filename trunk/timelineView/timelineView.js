(function($,H){	var padding = 10;		function parseDate(str){		var arr = str.split(".");		if(arr.length==2) arr = [1].concat(arr);		else if(arr.length==1) arr = [1, 1].concat(arr);				return Date.parse(arr.reverse().join("/"));	}		function formatDate(d){		if(typeof(d)=="number") d = new Date(d);		var arr = [			d.getDate(),			d.getMonth()+1,			d.getYear()+1900		];		if(arr[0]<10) arr[0] = "0"+arr[0];		if(arr[1]<10) arr[1] = "0"+arr[1];		return arr.join(".");	}		function getTimeRange(doc){		var min, max;		$.each(doc, function(i, itm){			if(itm.date){				itm.begin = parseDate(itm.date);			}			else{				itm.begin = parseDate(itm.begin);				itm.end = parseDate(itm.end);				if(!min) min = itm.begin;				if(!max) max = itm.end;				if(itm.end<min) min = itm.end; if(itm.end>max) max = itm.end;			}			if(itm.begin<min) min = itm.begin; if(itm.begin>max) max = itm.begin;		});				return {min:min, max:max};	}		var templates = {		main: function(doc, range, pnlSz){with(H){			var xRate = (range.max - range.min)/pnlSz;			return div({"class":"timelineView"},				apply(doc, function(itm){					return itm.date? templates.date(itm, range, xRate)						:templates.range(itm, range, xRate);				})			);		}},		date: function(itm, range, xRate){with(H){			return div({				"class":"date",				title:itm.date + " " + (itm.description || ""),				style: style({					"margin-left": Math.round((itm.begin - range.min)/xRate)+"px"				})			}, itm.name);		}},		range: function(itm, range, xRate){with(H){			return div({				"class":"timeline",				title:[formatDate(itm.begin), formatDate(itm.end)].join(" - ") + " " + (itm.description || ""),				style: style({					"margin-left": Math.round((itm.begin - range.min)/xRate)+"px",					width:Math.round((itm.end-itm.begin)/xRate)+"px",					"background-color":itm.color || "#008"				})			}, itm.name);		}}	};	function buildView(pnl, doc){		var pnlSz = pnl.width() - 2*padding;		var range = getTimeRange(doc);		pnl.html(templates.main(doc, range, pnlSz));	}	$.fn.timelineView = function(tlDoc){		var doc = $.parseJSON(tlDoc);		$(this).each(function(i, el){			buildView($(el), doc);		});	}})(jQuery, Html);