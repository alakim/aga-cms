<html>
<head>
<script type="text/javascript">
var initDate = "16.06.2008";
var initNum = 4;

Date.parse = function(v){
	var d, M, y;
	var h = 0, m = 0, s = 0;
	var mt = v.match(/0?([1-3]?\d)[\.\/]0?(1?\d)[\.\/](\d\d(\d\d)?)/);
	if(mt){
		d = parseInt(mt[1]);
		M = parseInt(mt[2]) - 1;
		y = parseInt(mt[3]);
	}
	else if(mt = v.match(/(\d{4})\-0?(\d\d?)\-0?(\d\d?)/i)){
		d = parseInt(mt[3]);
		M = parseInt(mt[2]) - 1;
		y = parseInt(mt[1]);
		mt = v.match(/T(\d\d?)(:(\d\d?))?(:(\d\d?))?/);
		if(mt){
			h = parseInt(mt[1], 10);
			if(mt[2])
				m = parseInt(mt[3], 10);
			if(mt[4])
				s = parseInt(mt[5], 10);
		}
	}
	if(y<1000)
		y+=1900;
	var date = new Date(y, M, d, h, m, s);
	return date;
};
	
Date.prototype.format = function(){
	function addNulls(v){
		return (v<10?"0":"")+v;
	}
	var d = addNulls(this.getDate());
	var M = addNulls(this.getMonth()+1);
	var y = this.getFullYear();
	return d+"."+M+"."+y;
}

function $(id){return document.getElementById(id);}

function calc(){
	var curDate = $('date').value;
	if(curDate.length)
		curDate = Date.parse(curDate);
	else{
		curDate = new Date();
		$('date').value = curDate.format();
	}
	if(typeof(initDate)=="string")
		initDate = Date.parse(initDate);
	var dD = curDate - initDate;
	dD = Math.floor(dD/1000/60/60/24);
	var kNum = (initNum + dD) % 20;
	$('kafNum').innerHTML = kNum;
}

function init(){
	$('date').value = "";
	calc();
}
</script>
</head>
<body onload="init()">
	<h1>Кафизма</h1>
	<p><input type="button" onclick="init()" value="Сегодня"></p>
	<p>
		<input type="text" id="date" style="width:70px;">:
		<span id="kafNum"></span>
		<input type="button" onclick="calc()" value="Ввод">
	</p>
</body>
</html>